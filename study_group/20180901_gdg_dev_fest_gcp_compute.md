# GCP Compute 概要と選定

[スライド](https://speakerdeck.com/vvakame/devfest-tokyo-2018)

## クラウドの心得

* 自分で何でもかんでも管理だるい
  * 電源, 空調
* 追加リソースの調達が秒でできる
  * オンプレだるすぎ
* 管理を外部にやってもらう
* システムの価値増大に注力できる
  * ハード管理
  * 運用
  * の工数がへる
* セキュリティもアウトソースできる
  * ハードレイヤ, ソフトレイヤのセキュリティもめっちゃしっかりやってくれてる
  * Google と同じことするのは無理だよね？

## 可能性

* サービスが常に利用可能か
* スケールアップ, スケールダウン
  * 1台が強くても限界がくるし運用辛い
* スケールイン, スケールアウト
  * 台数の増減での対応のほうが運用が楽
  * トラフィックの量, 処理の辛さで台数を調達
* DB ボトルネック問題
  * マスタがスケールしない
    * Wrire のトランザクション性能を上げづらい
  * 分散データベース
    * 台数を増やせば性能がスケールする

## 分散処理になれる

* クラウドは分散処理をできるように上手に設計しないと辛い
  * いつマシンが増えるか
  * いつマシンが減るか
  * 状態をメモリだけに持つと死ぬ
    * サーバが1台しかない前提でセッション全部メモリにとかはやばい
  * クラウドでは悪手
    * どのサーバにいくかわからん
  * セッションを DB に共有してどのノードに来てもいいように

## 適材適所

* 特性を知れば知るほど上手にできる
  * 特性 = 長所と短所
  * 短所をつく = 間も無く死ぬ
    * 設計に無理が生じる
  * 有識者に相談する = コスパ良
    * サービス多すぎて何選べばいいかわからん問題

## IaaS, Paas, SaaS

* インフラ as a Service
* プラットフォーム 略
* サービス 略

上に行くほうが柔軟だ運用大変
下の方が不自由だけど運用楽

## チームと組織

* 組織構造から逆算して設計を決める
* MicroService vs Monolith
  * Monolith でもクラウドの恩恵は大きい

## 金

* 計算サイトがあるので計算してみよう
* 見積もりサイトで見積もりだけだと割としっぱいする
* Spanner の最小推奨構成は月額22万
* ポケモン Go だと Datastore -> Spanner で 50% 減

## サービス概要

### GAE

* Web アプリ構築に便利
* 管理メンテいらない
* 自動でスケール
* 高速なスピンアップ
* 1年でも2年でもほっておける
* めちゃくちゃトラフィックきたけどほっといても大丈夫だったみたいな事例
* メリット
  * Service, Version の概念がある
  * リリースのロールバックできる
  * 専用マネージドサービスがある
* デメリット
  * 固定IP使えない
  * GCEにプロキシ立てたりして対処
  * 好きなツールをインストールできない
  * Java, Python, Node で緩和
  * App Engine に魂がロックインされる問題
* Standard Envieronment(SE)
  * 自由度は少ないけどスピンアップは高速
* Flexible Envieronment
  * 裏でGCEが立ち上がるので遅いけど自由度高い

### GKE

* k8s 関連システム一式
* コンテナオーケストレーション
* 複数アプリ, マイクロサービスでもなんでもござれ
* やりたいことはだいたい全部できる
* LB など GCP フル活用
* マネージドなサービスで k8s を構成できる
* GKE On-prem がでたけど……
* OSS として発展途上
* 運用チームがいないと辛い
  * 要求され裏勉強量が単純に多い
  * Spinnaker, Envoy, Istio などなど
  * 周辺のOSSとか技術要素がめっちゃでてくる
  * 丸投げできる運用チーム欲しい

### GCE

* 素のVM
* 自分で何でもかんでも管理運用いる
  * OSのパッチとか
* 自分で管理するとこおおい
  * アプリエンジニア的にはまだ辛い
* 基本なんらかの抽象化があったほうがよい
  * GAE/FE, Dataflowなど

### Cloud functions

* イベント処理を捌くのが得意
  * アプリのリクエスト裁くのは微妙
* 単機能, 管理不要
* Node v8, Python 3.7に対応
  * Go もアルファになった
* AppEngine とは課金体系が違う
* 単一関数がデプロイ単位
  * アプリの構成には向かない
* 関数ありすぎ問題
* AppEngine でよくね？

### Firebase Hosting

* Firebase と略してはいけない
* ファイルホストできる
* リダイレクトとかの設定もかける
* フロントエンドの人はこれで満足では
* GitHub Pagesみたいなもの
* サーバ上で計算できない
  * Cloud functions になげたり

## 体験するには

* Codelabs やろう!

## チャート

* VM だけ
  * GCE
* 運用チームある
  * GKE
* 特殊なことやりたい
  * GKE
* ファイルホストしたいだけ
  * Firebase Hosting, AppEngine
* イベント捌きたいだけ
  * CF
* AppEngine でできそう
  * できななさそうなら GKE
