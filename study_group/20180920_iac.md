# 実践 Infrastructure as Code ハンズオン

[実践 Infrastructure as Code ハンズオン](https://cloud.withgoogle.com/next18/tokyo/my-schedule/session/224235)

## IaC

* インフラリソースのプロビジョニングと管理を機械可読のファイルで行う

## インフラストラクチャ

* 演算
* ネットワーク
* ストレージ
* CDN
* DB
* ソースリポジトリ
* サードパーティサービス

## 命令型の設計

1. インスタンスの作成
2. ボリュームのマウント
3. IP の公開

* 目的の状態を理解しづらい
* 実行順序は理解しやすい
* 並列化が困難

## 宣言型の設計

* ボリュームとパブリックIPでインスタンスを作成
  * 最終形を書く
  * How は書かない

* 目的の状態を理解しやすい
* 実行順序がわかりづらい
* 並列化が用意
* Iac で採用する割合が高くなってる
  * 重要なのは最終形

## IaC 利点

* コードとして扱える
* 改訂履歴
* PR
* CI/CDとの統合
  * テストが可能
* アプリケーション開発者が長年有していたものをすべてを活用

## 自動化

* 通常IaCには自動化が伴う
* Lint
* CI/CDの統合
* 認証の取り扱い

## なぜ自動化か

* 本番環境のデプロイをロックダウン
* 開発環境と本番環境、アプリケーションなど、複数の環境間の複雑性とパリティを管理
* コラボレーターや管理者による変更管理, レビュー
* 構成の再利用が可能

## 自動化の方法

* クラウドのリソースと依存関係を識別するファイルを作成
* 最終状態を説明, または手順を説明(宣言と命令)
* 明確で管理された認証
* サポートされている安定したツールでデプロイ

## Terraform

* OSS の IaC ツール
* 単一の静的バイナリ(Golang)
* モジュール式設計
  * 共有や拡張が用意
* ロールに関わらず一貫したワークフローを提供
* 複数の環境をサポート
* 複数のクラウドをサポート

## GCP における Terraform

* エンジニアによる専門チーム
* すべての GCP API をカバーすることを目指す
* Magic Modules

## Terraform の構成

* 宣言型
* HCL で記述
* 拡張子が .tf のあらゆるファイルが読み取られる

## Terraform のワークフロー

* プレビュー(plan)
* デプロイ(apply)
* 検証および調査(show)
* クリーンアップ(destroy)

## ハンズオン

[https://github.com/sethvargo/infra-as-code-workshop](https://github.com/sethvargo/infra-as-code-workshop)

* `*.tf` 全部読み込むので変数は別の `*.tf` ファイルに書いて置ける
  * オーバーライドもできる
