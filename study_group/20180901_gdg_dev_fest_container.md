# Container

## コンテナとは

コンテナ同士は同じ規格にマッチしている
他のことを気にしなくても同じ規格で作れば運ぶことができる
中のことを気にしなくてもコンテナ間は隔離されている

コンテナとは

* 統一された規格
* どこでも動かすことができる
* 各環境が隔離されている

## Prod環境でコンテナを使う利点

* 使い捨て簡単
* 増やすの簡単
* 減らすの簡単

スケールイン, スケールアウトするクラウドと相性がいい

* アプリケーションの依存性を内包できる
  * 隔離の境界がある
* アプリケーションを画一的に運用できる
  * アプリはアプリを運用する人
  * インフラはインフラを運用する人みたいに
  * 分けて運用できる

注意点

* 一度コンテナを作ったらコンテナの中をいじらない
  * Immutable
* コンテナの中にデータを保存しない
  * Stateless
  * 一方のコンテナだけに保存されてしまうと他のコンテナからは見えない
* コンテナ自体の管理運用をちゃんとしないといけない
  * いろんなものを見なければいけない

## GKE

* k8s を自動で管理運用してくれるサービス
* k8s の中身は管理運用してくれない
  * k8s を理解してから使おう
* node-pool
  * Node をまとめて管理する概念と Node のスケール機能を提供
  * XXのコンテナはこっちのノードにデプロイみたいな
* 他のGCP製品と容易に接続可能
  * GCLB, GCS, Spanner など

### k8s

* コンテナのオーケストレーションツール
  * 管理運用をいい感じにサポートしてくれるツール
  * コンテナが生きてる/死んでる？
  * どういう風にデプロイしたらいいのか
  * 管理者が運用するものをわかりやすく抽象化してある
  * k8s で検索して一番上にチュートリアルあるのでおすすめ
    * ブラウザからできる
* リソースの自動配分
  * 適切な Node にコンテナを配置してくれる
* 水平スケール
  * さらにリソースが必要になったら自動的にリソースを増やす
* 自動ヒーリング
  * コンテナノードが死んだら勝手に追加してくれる
* サービスディスカバリとロードバランシング
  * どの Node にアプリがあるか
  * アプリ間通信の制御, ロードバランス
* 自動ロールアウト, ロールバック
  * コマンド一つでコンテナをデプロイする

## Stackdriver

* サービス, システムのモニタリングサービス
* logging
  * stdout にログを吐くと Stackdriver loging がキャッチしてくれる
* tracing とか

## Container Registry

* Google が管理運用してくれるプライベートなコンテナのリポジトリ
  * Docker Hub みたいなののプライベート版
* 脆弱性の診断をしてくれたりする
  * レベル付け, リファレンスのリンクも出してくれる

## Cloud Build

* Google が管理運用してくれるコンテナのビルドとワークフローの指定と管理を行うツール
* ビルドを行う計算資源も自動確保, まあまあ早い
* 現状は CrcleCI のほうが……

## Cloud Services Platform

* Google が管理する Istio
* Container Registry, Bazel
* Stackdriver Services Monitoring
* GKE On-Prem でハイブリット環境を構築

Google が描く現状の最適解をパッケージ提供

## まとめ

* コンテナは便利
* 可溶性を確保したいときにおすすめ
* コンテナの管理運用するツールはGCPは豊富に提供してる
* 落とし穴, 考え所はいっぱいあるよ
